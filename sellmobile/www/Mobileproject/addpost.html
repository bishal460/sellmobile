<!DOCTYPE html>
<html>
<head>
	<title>Add Post</title>
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.css' rel='stylesheet' />
  
  <style type="text/css">
  	.heading1{
		width: 100%;
		text-align: center;
	}
  #map { width:100%; 
   height: 400px;
  }
	.ads{
		width: 100%;
		padding: 10px 10%;
		height: 100px;
		margin-top: 20px;		
	}
	.ads .grid-container{
		margin: 0 auto;
		width: 70%;
		padding: 5px;
		margin-bottom: 5px;
		background-color: rgb(241,241,246);
	}
	@media only screen and (max-width: 600px) {
  .ads .grid-container{
  	grid-template-columns: auto;
  	width: 100%;
  }
}
  </style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="dashboard.html">Home</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="addpost.html">AddPost</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="viewmypost.html">ViewMyPost</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="logout()" >Log out</a>
      </li>
    </ul>
  </div>
</nav>
<div class="heading1">
	<h1>Add your Post here...</h1>
</div>
<div class="ads">
	<div class="grid-container">
		<form action="http://localhost/mobilesell/addpost.php" enctype="multipart/form-data" method="post">
			<div class="input-group mb-3">
  			<div class="input-group-prepend">
    <span class="input-group-text" id="basic-addon1">Mobile Image</span>
  </div>
  <input class="form-control" type="file" name="image" id="image" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile Name</span>
</div>
<input class="form-control" type="text" name="mobile_name" id="mobile_name" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile Description</span>
</div>
<input class="form-control" type="text" name="description" id="description" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile price</span>
</div>
<input class="form-control" type="text" name="price" id="price" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile condition</span>
</div>
<input class="form-control" type="text" name="condition" id="condition" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile cpu</span>
</div>
<input class="form-control" type="text" name="cpu" id="cpu" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile ram</span>
</div>
<input class="form-control" type="text" name="ram" id="ram" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile gpu</span>
</div>
<input class="form-control" type="text" name="gpu" id="gpu" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile weight</span>
</div>
<input class="form-control" type="text" name="weight" id="weight" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Mobile os</span>
</div>
<input class="form-control" type="text" name="os" id="os" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">IMEI Number</span>
</div>
<input class="form-control" type="text" name="imei" id="imei" required>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
<span class="input-group-text" id="basic-addon1">Choose Your location on the Map</span>
</div>
                <div id='map'></div>
</div>

			<input class="form-control" type="submit" id="onsubmit" name="submit"></ins>
		</form>
	</div>
</div>

<script type="text/javascript">
            latitude1 = ""
            longitude1 = ""
            var marker;
        L.mapbox.accessToken = 'pk.eyJ1IjoibGVvbmd1cnVuZzAyOSIsImEiOiJjang2NHZzengwODJuNDVxdTM2NDBmdWJlIn0.CPb6da7yRq1sII4tOt7quA';
        var map = L.mapbox.map('map')
            .setView([27.7172, 85.3240], 12)
            .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));
        map.on('click', function(e) {
            latitude1 = e['latlng']['lat']
            longitude1 = e['latlng']['lng']
            marker = L.marker([latitude1, longitude1], {
      icon: L.mapbox.marker.icon({
        'marker-color': '#9c89cc'
      })
    })
    .bindPopup('<button class="trigger">Say hi</button>')
    .addTo(map);
        })

document.getElementById("onsubmit").addEventListener("click",function(e) {
  if(latitude1 == "" || longitude1 == ""){
            alert("Please click on the map to choose location")
            return
        }
        const email1 = localStorage.getItem('email')
        console.log(email1)
var data = {
  image:$('#image')[0].files[0],
  mobile_name: $('#mobile_name').val(),
  description: $('#description').val(),
  price: $('#price').val(),
  condition: $('#condition').val(),
  cpu: $('#cpu').val(),
  ram: $('#ram').val(),
  gpu: $('#gpu').val(),
  weight: $('#weight').val(),
  os: $('#os').val(),
  imei:$('#imei').val(),
  latitude:latitude1,
  longitude:longitude1,
  user:email1
}

var fomdata = new FormData()

for(x in data){
    fomdata.append(x,data[x])
  }
  $.ajax(
      {
        url: 'http://localhost/mobilesell/addpost.php',
        method:'POST',
        contentType:false,
        processData:false, // for all type files it should be false otherwise application/json
        data: fomdata,   // JSON.stringify(data)
        dataType:'json',
        success: (data,status,jqxHR)=>{
          alert("Success adding post")
          e.preventDefault()
        },
        error:(data,result)=>{
          alert("Success adding post")
          e.preventDefault()
        }
      }
    )
e.preventDefault()
})

function logout(){
	localStorage.clear('email')
	window.location.href = "index.html"
}
</script>
</body>
</html>